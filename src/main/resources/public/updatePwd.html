<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
 

<link rel='stylesheet' href='assets/css/plugins/fullcalendar.css'>
<link rel='stylesheet' href='assets/css/plugins/datatables/datatables.css'>
<link rel='stylesheet' href='assets/css/plugins/datatables/bootstrap.datatables.css'>
<link rel='stylesheet' href='assets/css/plugins/chosen.css'>
<link rel='stylesheet' href='assets/css/plugins/jquery.timepicker.css'>
<link rel='stylesheet' href='assets/css/plugins/daterangepicker-bs3.css'>
<link rel='stylesheet' href='assets/css/plugins/colpick.css'>
<link rel='stylesheet' href='assets/css/plugins/dropzone.css'>
<link rel='stylesheet' href='assets/css/plugins/jquery.handsontable.full.css'>
<link rel='stylesheet' href='assets/css/plugins/jscrollpane.css'>
<link rel='stylesheet' href='assets/css/plugins/jquery.pnotify.default.css'>
<link rel='stylesheet' href='assets/css/plugins/jquery.pnotify.default.icons.css'>
<link rel='stylesheet' href='assets/css/app.css'>

  <link href='http://fonts.googleapis.com/css?family=Roboto:100,300,400,700|Roboto+Condensed:300,400,700' rel='stylesheet' type='text/css'>

  <link href="assets/favicon.ico" rel="shortcut icon">
  <link href="assets/apple-touch-icon.png" rel="apple-touch-icon">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    @javascript html5shiv respond.min
  <![endif]-->

  <title>updatePwd</title>
<style>
.error{
	color:red;
}
.focusedInput-waring {
    border-color: #EF5B50;
    outline: 0;
    outline: thin dotted \9;
    -webkit-box-shadow: 0 0 8px #EF5B50;
    box-shadow: 0 0 8px #EF5B50;
}

.focusedInput-info {
    border-color: #33CC3B;
    outline: 0;
    outline: thin dotted \9;
    -webkit-box-shadow: 0 0 8px #33CC3B;
    box-shadow: 0 0 8px #33CC3B;
}

</style>
</head>

<body class="glossed">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42863888-4', 'pinsupreme.com');
  ga('send', 'pageview');

</script>

<div class="all-wrapper no-menu-wrapper light-bg">
  <div class="login-logo-w">
    <!-- <a href="index.html" class="logo">
      <i class="fa fa-rocket"></i>
    </a> -->
  </div>
  <div class="row">
    <div class="col-md-4 col-md-offset-4">

      <div class="widget widget-blue">
        <div class="widget-title">
          <h3 class="text-center"><i class="fa fa-lock"></i>更改密码</h3>
        </div>
        <div class="widget-content">
          <form id="form1" method="post" action="" role="form">
            <div class="form-group relative-w">
              <input type="text" class="form-control" placeholder="请输入用户名" id="username" name="username" title="请输入用户名" required>
              <i class="fa fa-user input-abs-icon"></i>
            </div>
            <div class="form-group relative-w">
              <input type="password" class="form-control" placeholder="请输入旧密码" id="oldPwd" name="oldPwd" title="请输入旧密码,长度至少6位" required minlength="6" maxlength="12">
              <i class="fa fa-lock input-abs-icon"></i>
            </div>
            <div class="form-group relative-w">
              <input type="password" class="form-control" placeholder="请输入新密码" id="password" name="password" title="请输入新密码,长度至少6位" required minlength="6" maxlength="12">
              <i class="fa fa-lock input-abs-icon"></i>
            </div>
            <div class="form-group relative-w">
              <input type="password" class="form-control" placeholder="请再次输入新密码" id="password2" name="password2" title="请输入新密码,至少6位" required minlength="6" maxlength="12" onblur="validate()">
              <i class="fa fa-lock input-abs-icon"></i>
            </div>
            <div id='msg' class="error">
            </div>            
            <div class='modal-footer'>
                <button class='btn btn-primary' type='submit' id='confirmButton'>确定</button>
                <button class='btn btn-default' data-dismiss='modal' type='button' id='closeButton'>取消</button>
              </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script> -->
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.10.2.min.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.10.3/jquery-ui.min.js"></script>
<script src='https://ajax.aspnetcdn.com/ajax/jquery.validate/1.13.0/jquery.validate.min.js'></script>
<script src='https://ajax.aspnetcdn.com/ajax/jquery.validate/1.13.0/localization/messages_zh.js'></script>
<script src="https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src='assets/js/plugins/jquery.pnotify.js'></script>
<script src='assets/js/plugins/jquery.sparkline.min.js'></script>
<script src='assets/js/plugins/mwheelIntent.js'></script>
<script src='assets/js/plugins/mousewheel.js'></script>
<script src='assets/js/bootstrap/tab.js'></script>
<script src='assets/js/bootstrap/dropdown.js'></script>
<script src='assets/js/bootstrap/tooltip.js'></script>
<script src='assets/js/bootstrap/collapse.js'></script>
<script src='assets/js/bootstrap/scrollspy.js'></script>
<script src='assets/js/plugins/bootstrap-datepicker.js'></script>
<script src='assets/js/bootstrap/transition.js'></script>
<script src='assets/js/plugins/jquery.knob.js'></script>
<script src='assets/js/plugins/jquery.flot.min.js'></script>
<script src='assets/js/plugins/fullcalendar.js'></script>
<script src='assets/js/plugins/datatables/datatables.min.js'></script>
<script src='assets/js/plugins/chosen.jquery.min.js'></script>
<script src='assets/js/plugins/jquery.timepicker.min.js'></script>
<script src='assets/js/plugins/daterangepicker.js'></script>
<script src='assets/js/plugins/colpick.js'></script>
<script src='assets/js/plugins/moment.min.js'></script>
<script src='assets/js/plugins/datatables/bootstrap.datatables.js'></script>
<script src='assets/js/bootstrap/modal.js'></script>
<script src='assets/js/plugins/raphael-min.js'></script>
<script src='assets/js/plugins/morris-0.4.3.min.js'></script>
<script src='assets/js/plugins/justgage.1.0.1.min.js'></script>
<script src='assets/js/plugins/jquery.maskedinput.min.js'></script>
<script src='assets/js/plugins/jquery.maskmoney.js'></script>
<script src='assets/js/plugins/summernote.js'></script>
<script src='assets/js/plugins/dropzone-amd-module.js'></script>
<script src='assets/js/plugins/jquery.validate.min.js'></script>
<script src='assets/js/plugins/jquery.bootstrap.wizard.min.js'></script>
<script src='assets/js/plugins/jscrollpane.min.js'></script>
<script src='assets/js/application.js'></script>
<script src='assets/js/cookie.js'></script>

</body>
<script type="text/javascript">
	function validate() {
	    var pwd1 = $("input[name='password']").val();
	    var pwd2 = $("input[name='password2']").val();
	    if (pwd2 == pwd1) {
	        $("input[name='password']").addClass("focusedInput-info").removeClass("focusedInput-waring");
	        $("input[name='password2']").addClass("focusedInput-info").removeClass("focusedInput-waring");
	        $("button").removeAttr("disabled");
	        $("#msg").text('');
	    }
	    else {
	        $("input[name='password']").addClass("focusedInput-waring").removeClass("focusedInput-info");
	        $("input[name='password2']").addClass("focusedInput-waring").removeClass("focusedInput-info");
	        $("button").attr("disabled", "disabled");
	        $("#msg").text('两次输入的密码不一致');
	    }
	}

    $("#username").val(getCookie("username"));
    $.validator.setDefaults({
     submitHandler: function() {
      var username = $("#username").val();
      var oldPwd = $("#oldPwd").val();
      var password = $("#password").val();
      var password2 = $("#password2").val();
      if(password != password2){
         alert('两次输入的密码不一致');
         return false;
      }
      $.ajax({
        url: '/api/modifyPwd',
        type: 'post',
        contentType: 'application/json',
        //contentType:"application/x-www-form-urlencoded; charset=UTF-8",
        data: JSON.stringify({username:username,oldPwd:oldPwd,password:password,password2:password2}),
        //dataType: 'text',
        success: function (res) {
          if(res.code==200){
        	  alert('修改成功')
              window.location='/index.html';
          }else{
            $("#msg").text(res.message);
          }
        }

      })
     }
    });
    $().ready(function() {
      var validator =  $("#form1").validate();
      $("#closeButton").click(function() {
        validator.resetForm();
      });
     });


  </script>
</html>